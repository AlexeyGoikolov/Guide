@model Book

@{
    ViewBag.Title = "Книга";
    Layout = "_Layout";
}
<div class="page">
    <!-- заголовок страницы -->
    <div class="pageheader">
        <h2>
            @ViewBag.Title <br/>@Model.Name</h2>
        <div class="page-bar">
            <ul class="page-breadcrumb">
                <li>
                    <a asp-action="Details" asp-controller="Account"><i class="fa fa-home"></i> Guide</a>
                </li>
                <li>
                    <a asp-action="Index" asp-controller="SourceManage">Библиотека</a>
                </li>
                <li>
                    <a asp-action="Details" asp-controller="BooksManage" asp-route-id="@Model.Id">@Model.Name</a>
                </li>
            </ul>
        </div>
    </div>
    <!--/ заголовок страницы -->

    <div class="page row">

        <div class="tile-body">

            <div class="row">

                <div class="col-sm-4 portlets sortable">
                    <section class="tile portlet ">

                        <!-- tile body -->
                        <div class="tile-body">
                            <div  style="text-align: center; margin: 10px;">
                                <img style=" width: 100%;-webkit-box-shadow: 14px 14px 28px -6px rgba(53,3,71,0.57);
                                                                          -moz-box-shadow: 14px 14px 28px -6px rgba(53,3,71,0.57);
                                                                          box-shadow: 14px 14px 28px -6px rgba(53,3,71,0.57);" src="@Model.CoverPath" alt="изображение обложки">
                            </div>
                        </div>
                        <!-- /tile body -->

                    </section>
                </div>
                <div class="col-sm-8 portlets sortable">
                    <section class="tile portlet ">
                        <!-- tile body -->
                        <div class="tile-body">
                            <div style="text-align: right; margin-right: 10px ">
                                @if (Model.IsRecipe)
                                {
                                    <span style="color: #0a6aa1">является Рецептом :</span>
                                }
                                ISBN @Model.ISBN
                            </div>
                            <div>
                                <h4>@Model.Author : </h4>
                                <h2>" @Model.Name "</h2>
                            </div>
                            <div>год издания : @Model.YearOfWriting</div>
                            <div> редакция  : @Model.Edition</div>
                            <div>дата добавления в систему : @Model.DateCreate</div>
                            <div>дата последнего исправления : @Model.DateUpdate</div>
                            <div>
                                @if (Model.PhysicalPath == null)
                                {
                                    <p style="color: #0f9dca; font-style: inherit;">только в электронном виде</p>
                                }
                                else
                                {
                                    <p>книга находится : @Model.PhysicalPath</p>
                                }
                            </div>
                            <div>
                                <a asp-action="ReadBook" asp-controller="BooksManage" asp-route-path="@Model.VirtualPath" asp-route-id="@Model.Id"><i class="fa fa-book"></i> читать книгу </a>
                            </div>
                            
                        </div>

                        <!-- /tile body -->

                    </section>
                </div>
            </div>
        </div>
        <!-- /tile body -->
        <div>
            <div class="" >
                <textarea id="comment_area" class="form-control textarea_chat" placeholder="Оставить свой комментарий..." rows="2"></textarea>
                <button type="button" class="btn btn-info mt-10" name="@Model.Id" id="sendComment">Добавить комментарий</button>
                <button type="button" class="btn btn-info mt-10" onclick="viewComment('@Model.Id')">Посмотреть комментарии</button>
                <div class="clearfix"></div>
            </div>
        </div>
        <div class="panel panel-info mt-10">
            <div id="listComment"></div>
        </div>
    </div>
</div>

@section Scripts
{
    <script>
        $('#sendComment').click(function(event) {
            event.preventDefault();
            let id = $('#sendComment').attr('name');
            let comment = $('#comment_area').val();
            reset();        
            $.ajax({
                url: '@Url.Action("CreateComment", "SourceManage")',
                type: 'POST',
                data: { 
                    'sourceId': id, 
                    'description': comment,
                    'type': "book"},
                success: function(data) {
                    $('#listComment').html(data); 
                },
            });  
        });
        
        let reset = function() {
            $('#comment_area').val("");               
        };
        
        function deleteComment(Id, PostId) {
            $.ajax({
                url: '@Url.Action("DeleteComment", "SourceManage")',
                type: 'GET',
                data: { 
                    'id': Id,
                    'sourceId': PostId,
                    'type': "book" 
                },
                success: function(data) {
                    $('#listComment').html(data); 
                },
            });   
        }
              
        function viewComment(id) {
                              
            $.ajax({
                url: '@Url.Action("ViewComment", "SourceManage")',
                type: 'GET',
                data: { 
                    'id': id,
                    'type': "book"
                 },
                success: function(data) {
                $('#listComment').html(data); 
                },
            });   
        }        
    </script>
}
